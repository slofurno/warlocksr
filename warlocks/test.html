<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
</head>
<body>

    <script src="Scripts/jquery-1.10.2.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.1.0.js"></script>

    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>



    <script src="warlocks.js"></script>


    <script>

        var controller = {dleft:0, dright:0, dup:0, ddown:0, rightx:0, righty:0, righttrigger:0};

        controller.toString = function () {

            var str = "dleft " + this.dleft + "dright " + this.dright + "dup " + this.dup + "ddown " + this.ddown + "rightx " + this.rightx + "righty " + this.righty + "righttrigger " + this.righttrigger;

            return str;

        }

        function tick() {
            window.requestAnimationFrame(tick);
            GetInput(controller);

            console.log(controller.toString());

            //console.log("axis 0" + controller.axes[0] + " " + controller.axes[1] + " " + controller.axes[2] + " " + controller.axes[3] + " " + controller.axes[4] + " " + controller.axes[5] + " ");
           
        }



       
        
        function GetInput(controller) {

            if (navigator.getGamepads) {
               
                var tolerance = .3;

                controller.dleft = 0;
                controller.dright = 0;
                controller.dup = 0;
                controller.ddown = 0;
                controller.rightx = 0;
                controller.righty = 0;
                controller.righttrigger = 0;

                var gamepadarray = navigator.getGamepads();

                if (gamepadarray.length > 0) {

                    var gamepad = gamepadarray[0];
                    var buttons = gamepad.buttons;
                    var axes = gamepad.axes;

                    if (gamepad.axes.length < 6) {

                        
                        //chrome reads dpad as buttons
                        controller.ddown = buttons[13].value;
                        controller.dup = buttons[12].value;
                        controller.dleft = buttons[14].value;
                        controller.dright = buttons[15].value;


                        if (buttons[7].value >= tolerance) {
                            controller.righttrigger = 1;
                        }

                        //chrome reads x and y from different index then firefox
                        controller.rightx = axes[2];
                        controller.righty = axes[3];
                       


                    }
                    else {
                        //firefox reads dpad as axes

                        if (axes[5] == -1) {
                            controller.dleft = 1;
                        }
                        else if (axes[5] == 1) {
                            controller.dright = 1;

                        }
                        if (axes[6] == -1) {
                            controller.dup = 1;

                        }
                        else if (axes[6] == 1) {
                            controller.ddown = 1;
                        }

                        if (axes[4] <= -tolerance) {
                            controller.righttrigger = 1;
                        }

                        controller.rightx = axes[3];
                        controller.righty = axes[2];

                    }

                    for (var i = 0; i < gamepadarray[0].axes.length; i++) {

                        //console.log(i + "   " + gamepadarray[0].axes[i]);

                    }

                }
                else {
                    console.log("no gamepad detected");
                }

            }


        }
        


        tick();

    </script>












</body>
</html>
